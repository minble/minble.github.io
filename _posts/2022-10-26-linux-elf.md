---
title: "ğŸ’»(Linux) Executable and Linking Format (ELF)"
author: minble
date: 2022-10-26 00:00:00 +0800
categories: [Linux]
tags: [executable and linking format, elf]
---

gccì™€ ê°™ì€ ì»´íŒŒì¼ëŸ¬ë¥¼ ì´ìš©í•˜ë©´ **ì†ŒìŠ¤ì½”ë“œ**ëŠ” ì˜¤ë¸Œì íŠ¸ ì½”ë“œë¡œ ë³€í™˜ë˜ë©°, ë§ì»¤ëŠ” **ì˜¤ë¸Œì íŠ¸ ì½”ë“œ**ë¥¼ ì°¸ì¡°ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ê³¼ ì—°ê²°(link)í•œ **ë°”ì´ë„ˆë¦¬ íŒŒì¼**ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì´ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì€ íŠ¹ì •í•œ êµ¬ì¡°ë¥¼ ê°€ì§€ëŠ”ë°, ê°€ì¥ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” í˜•íƒœëŠ” Executable and Linkable Format(ELF)ì…ë‹ˆë‹¤. ì´ í˜•íƒœëŠ” ì‹¤í–‰ íŒŒì¼, ì¬ë°°ì¹˜ ê°€ëŠ¥í•œ ì˜¤ë¸Œì íŠ¸ íŒŒì¼(relocatable object files), ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬, ì½”ì–´ ë¤í”„ì— ë„ë¦¬ ì‚¬ìš©ë©ë‹ˆë‹¤.

ELFëŠ” ìœ ì—°ì„±(flexibility), í™•ì¥ì„±(extensibility), ë‹¤ì–‘í•œ ì—”ë””ì•ˆ(Endian) í˜•ì‹ê³¼ ì£¼ì†Œ í¬ê¸°ì— ëŒ€í•œ í¬ë¡œìŠ¤ ì»´íŒŒì¼ ì§€ì› ë“±ì˜ ì¥ì ì´ ìˆì–´ì„œ ë‹¤ì–‘í•œ ìš´ì˜ì²´ì œì—ì„œ ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤. [^1]

## ELFì˜ êµ¬ì¡°
ELF íŒŒì¼ì€ ELF í—¤ë”ì™€ íŒŒì¼ ë°ì´í„°ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. íŒŒì¼ ë°ì´í„° ì„¹ì…˜ì€ í”„ë¡œê·¸ë¨ í—¤ë” í…Œì´ë¸”, ì„¹ì…˜ í—¤ë” í…Œì´ë¸”, í”„ë¡œê·¸ë¨ í—¤ë” í…Œì´ë¸”ê³¼ ì„¹ì…˜ í—¤ë” í…Œì´ë¸”ì˜ ì—”íŠ¸ë¦¬ì—ì„œ ì°¸ì¡°ë˜ëŠ” ë°ì´í„°ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

### ELF í—¤ë” (ELF Header)
> `/usr/include/elf.h`ì˜ `struct Elf32_Ehdr`, `struct Elf64_Ehdr`

ELF í—¤ë”ëŠ” 32byteì´ë©° íŒŒì¼ì˜ í˜•ì‹ì„ ì •ì˜í•©ë‹ˆë‹¤. í•­ìƒ ì˜¤í”„ì…‹ 0ì—ì„œ `0x7F`, `0x45`(E), `0x4c`(L), `0x46`(F)ìœ¼ë¡œ ì‹œì‘ë˜ë©° ì´í›„ ë°ì´í„°ë“¤ì€ ELF íŒŒì¼ì˜ ë¹„íŠ¸(32bit/64bit), ì—”ë””ì•ˆ(little/big), ì»´íŒŒì¼ëœ ìš´ì˜ì²´ì œ í™˜ê²½, ELF ë²„ì „ ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤.

ELF íŒŒì¼ì„ `hexdump`ë¡œ í™•ì¸í•´ë³´ë©´ ELFë¡œ ì‹œì‘í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `ls` ë°”ì´ë„ˆë¦¬ë¥¼ ì´ìš©í•´ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. 

```bash
root@docker-blog-ming:/blog/tools# hexdump -C /usr/bin/ls | head -5
00000000  7f 45 4c 46 02 01 01 00  00 00 00 00 00 00 00 00  |.ELF............|
00000010  03 00 3e 00 01 00 00 00  b0 6a 00 00 00 00 00 00  |..>......j......|
00000020  40 00 00 00 00 00 00 00  20 14 02 00 00 00 00 00  |@....... .......|
00000030  00 00 00 00 40 00 38 00  0d 00 40 00 1f 00 1e 00  |....@.8...@.....|
00000040  06 00 00 00 04 00 00 00  40 00 00 00 00 00 00 00  |........@.......|
```

`readelf` ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´ í—¤ë”ì— í¬í•¨ëœ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `-h`, `-file-header`ëŠ” ELF íŒŒì¼ì˜ í—¤ë”ë¥¼ ë³´ì—¬ì£¼ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤.

```bash
root@docker-blog-ming:/blog/tools# readelf -h /usr/bin/ls
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              DYN (Position-Independent Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x6ab0
  Start of program headers:          64 (bytes into file)
  Start of section headers:          136224 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         13
  Size of section headers:           64 (bytes)
  Number of section headers:         31
  Section header string table index: 30
```

### í”„ë¡œê·¸ë¨ í—¤ë” (Program Header)
> `/usr/include/elf.h`ì˜ `struct Elf32_Phdr`, `struct Elf64_Phdr`

í”„ë¡œê·¸ë¨ í—¤ë”ëŠ” ì‹¤í–‰ì‹œ ì‚¬ìš©í•˜ë©° ì»¤ë„ì´ë‚˜ ëŸ°íƒ€ì„ ë§ì»¤ `ld.so` ì—ê²Œ ë©”ëª¨ë¦¬ì— ë¡œë“œí•  ë‚´ìš©ê³¼ ë™ì  ë§í¬ ì •ë³´ë¥¼ ì–´ë–»ê²Œ ì°¾ëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. [^2]

ìœ„ì—ì„œ ì‚´í´ë³¸ ELF í—¤ë”ë¥¼ ë³´ë©´ í•´ë‹¹ ë°”ì´ë„ˆë¦¬ëŠ” 13ê°œì˜ í”„ë¡œê·¸ë¨ í—¤ë”ë¥¼ ê°€ì§€ê³  ìˆê³ (`Number of program headers`) ê° í”„ë¡œê·¸ë¨ í—¤ë”ì˜ í¬ê¸°ëŠ” 56byteì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤(`Size of program headers`). ì²« ë²ˆì§¸ í”„ë¡œê·¸ë¨ í—¤ë”ëŠ” 64byteë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤(`Start of program headers`)

`readelf` ëª…ë ¹ì–´ì˜ `-l`, `-program-headers`, `-segments` ì˜µì…˜ì„ ì´ìš©í•˜ë©´ ELF íŒŒì¼ì—ì„œ í”„ë¡œê·¸ë¨ í—¤ë” ì •ë³´ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

```bash
root@docker-blog-ming:/blog/tools# readelf -l /usr/bin/ls

Elf file type is DYN (Position-Independent Executable file)
Entry point 0x6ab0
There are 13 program headers, starting at offset 64

Program Headers:
  Type           Offset             VirtAddr           PhysAddr
                 FileSiz            MemSiz              Flags  Align
  PHDR           0x0000000000000040 0x0000000000000040 0x0000000000000040
                 0x00000000000002d8 0x00000000000002d8  R      0x8
  INTERP         0x0000000000000318 0x0000000000000318 0x0000000000000318
                 0x000000000000001c 0x000000000000001c  R      0x1
      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000
                 0x0000000000003428 0x0000000000003428  R      0x1000
  LOAD           0x0000000000004000 0x0000000000004000 0x0000000000004000
                 0x0000000000013146 0x0000000000013146  R E    0x1000
  LOAD           0x0000000000018000 0x0000000000018000 0x0000000000018000
                 0x0000000000007458 0x0000000000007458  R      0x1000
  LOAD           0x0000000000020000 0x0000000000021000 0x0000000000021000
                 0x0000000000001278 0x0000000000002540  RW     0x1000
  DYNAMIC        0x0000000000020a98 0x0000000000021a98 0x0000000000021a98
                 0x00000000000001c0 0x00000000000001c0  RW     0x8
  NOTE           0x0000000000000338 0x0000000000000338 0x0000000000000338
                 0x0000000000000030 0x0000000000000030  R      0x8
  NOTE           0x0000000000000368 0x0000000000000368 0x0000000000000368
                 0x0000000000000044 0x0000000000000044  R      0x4
  GNU_PROPERTY   0x0000000000000338 0x0000000000000338 0x0000000000000338
                 0x0000000000000030 0x0000000000000030  R      0x8
  GNU_EH_FRAME   0x000000000001cdcc 0x000000000001cdcc 0x000000000001cdcc
                 0x000000000000056c 0x000000000000056c  R      0x4
  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000
                 0x0000000000000000 0x0000000000000000  RW     0x10
  GNU_RELRO      0x0000000000020000 0x0000000000021000 0x0000000000021000
                 0x0000000000001000 0x0000000000001000  R      0x1

 Section to Segment mapping:
  Segment Sections...
   00     
   01     .interp 
   02     .interp .note.gnu.property .note.gnu.build-id .note.ABI-tag .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt 
   03     .init .plt .plt.got .plt.sec .text .fini 
   04     .rodata .eh_frame_hdr .eh_frame 
   05     .ctors .dtors .data.rel.ro .dynamic .got .data .bss 
   06     .dynamic 
   07     .note.gnu.property 
   08     .note.gnu.build-id .note.ABI-tag 
   09     .note.gnu.property 
   10     .eh_frame_hdr 
   11     
   12     .ctors .dtors .data.rel.ro .dynamic .got 
```

### ì„¹ì…˜ í—¤ë” (Section Header)
> `/usr/include/elf.h`ì˜ `struct Elf32_Shdr`, `struct Elf64_Shdr`

ì„¹ì…˜ í—¤ë”ëŠ” ì»´íŒŒì¼ íƒ€ì„ ë§í‚¹ì‹œ ì‚¬ìš©í•˜ë©° ë§í¬ ì—ë””í„°ì¸ `ld`ì—ê²Œ ì‹¬ë³¼ì„ ì–´ë–»ê²Œ resolveí•˜ëŠ”ì§€, ì–´ë–»ê²Œ ë‹¤ë¥¸ ELF ë°”ì´ë„ˆë¦¬ ì˜¤ë¸Œì íŠ¸ë“¤ì—ì„œ ìœ ì‚¬í•œ ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ì„ ê·¸ë£¹í™”í•˜ëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. [^2]

`readelf`ì˜ `-S`, `-section-headers`, `-sections` ì˜µì…˜ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
root@docker-blog-ming:/blog/tools# readelf -S /usr/bin/ls
There are 31 section headers, starting at offset 0x21420:

Section Headers:
  [Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  [ 0]                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           0     0     0
  [ 1] .interp           PROGBITS         0000000000000318  00000318
       000000000000001c  0000000000000000   A       0     0     1
  [ 2] .note.gnu.pr[...] NOTE             0000000000000338  00000338
       0000000000000030  0000000000000000   A       0     0     8
  [ 3] .note.gnu.bu[...] NOTE             0000000000000368  00000368
       0000000000000024  0000000000000000   A       0     0     4
  [ 4] .note.ABI-tag     NOTE             000000000000038c  0000038c
       0000000000000020  0000000000000000   A       0     0     4
  [ 5] .gnu.hash         GNU_HASH         00000000000003b0  000003b0
       000000000000004c  0000000000000000   A       6     0     8
  [ 6] .dynsym           DYNSYM           0000000000000400  00000400
       0000000000000b88  0000000000000018   A       7     1     8
  [ 7] .dynstr           STRTAB           0000000000000f88  00000f88
       00000000000005a6  0000000000000000   A       0     0     1
  [ 8] .gnu.version      VERSYM           000000000000152e  0000152e
       00000000000000f6  0000000000000002   A       6     0     2
  [ 9] .gnu.version_r    VERNEED          0000000000001628  00001628
       00000000000000c0  0000000000000000   A       7     2     8
  [10] .rela.dyn         RELA             00000000000016e8  000016e8
       00000000000013e0  0000000000000018   A       6     0     8
  [11] .rela.plt         RELA             0000000000002ac8  00002ac8
       0000000000000960  0000000000000018  AI       6    25     8
  [12] .init             PROGBITS         0000000000004000  00004000
       0000000000000025  0000000000000000  AX       0     0     4
  [13] .plt              PROGBITS         0000000000004030  00004030
       0000000000000650  0000000000000010  AX       0     0     16
  [14] .plt.got          PROGBITS         0000000000004680  00004680
       0000000000000030  0000000000000010  AX       0     0     16
  [15] .plt.sec          PROGBITS         00000000000046b0  000046b0
       0000000000000640  0000000000000010  AX       0     0     16
  [16] .text             PROGBITS         0000000000004cf0  00004cf0
       0000000000012441  0000000000000000  AX       0     0     16
  [17] .fini             PROGBITS         0000000000017134  00017134
       0000000000000012  0000000000000000  AX       0     0     4
  [18] .rodata           PROGBITS         0000000000018000  00018000
       0000000000004dcc  0000000000000000   A       0     0     32
  [19] .eh_frame_hdr     PROGBITS         000000000001cdcc  0001cdcc
       000000000000056c  0000000000000000   A       0     0     4
  [20] .eh_frame         PROGBITS         000000000001d338  0001d338
       0000000000002120  0000000000000000   A       0     0     8
  [21] .ctors            PROGBITS         0000000000021000  00020000
       0000000000000010  0000000000000000  WA       0     0     8
  [22] .dtors            PROGBITS         0000000000021010  00020010
       0000000000000010  0000000000000000  WA       0     0     8
  [23] .data.rel.ro      PROGBITS         0000000000021020  00020020
       0000000000000a78  0000000000000000  WA       0     0     32
  [24] .dynamic          DYNAMIC          0000000000021a98  00020a98
       00000000000001c0  0000000000000010  WA       7     0     8
  [25] .got              PROGBITS         0000000000021c58  00020c58
       00000000000003a0  0000000000000008  WA       0     0     8
  [26] .data             PROGBITS         0000000000022000  00021000
       0000000000000278  0000000000000000  WA       0     0     32
  [27] .bss              NOBITS           0000000000022280  00021278
       00000000000012c0  0000000000000000  WA       0     0     32
  [28] .gnu_debugaltlink PROGBITS         0000000000000000  00021278
       0000000000000049  0000000000000000           0     0     1
  [29] .gnu_debuglink    PROGBITS         0000000000000000  000212c4
       0000000000000034  0000000000000000           0     0     4
  [30] .shstrtab         STRTAB           0000000000000000  000212f8
       0000000000000125  0000000000000000           0     0     1
Key to Flags:
  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),
  L (link order), O (extra OS processing required), G (group), T (TLS),
  C (compressed), x (unknown), o (OS specific), E (exclude),
  D (mbind), l (large), p (processor specific)
```

### ë§í‚¹ ë·°(Linking View)ì™€ ë¡œë”© ë·°(Loading View)

![elf view](posts/2022-10-26-elf-view.svg)

ELFì—ëŠ” ë§í‚¹ ë·°ì™€ ë¡œë”© ë·°(í˜¹ì€ ì‹¤í–‰ ë·°(Execution View)ë¼ê³ ë„ í•©ë‹ˆë‹¤.)ê°€ ìˆìŠµë‹ˆë‹¤. **ë§í‚¹ ë·°**ëŠ” ì‹¤í–‰ íŒŒì¼ì„ ì—¬ëŸ¬ ì„¹ì…˜ìœ¼ë¡œ ë‚˜ëˆˆ í˜•íƒœë¡œ[^3] ì„¹ì…˜ í—¤ë”ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì‰½ê²Œ ë§í•˜ë©´ ì¬ë°°ì¹˜ ê°€ëŠ¥í•œ íŒŒì¼ í˜•ì‹ìœ¼ë¡œ ë§í¬í•˜ê¸° ì „ ì˜¤ë¸Œì íŠ¸ íŒŒì¼ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. [^4] **ë¡œë”© ë·°**ëŠ” ë” ë‹¨ìˆœí•˜ê²Œ ì‹¤í–‰ íŒŒì¼ì„ ì—¬ëŸ¬ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë‚˜ëˆˆ í˜•íƒœë¡œ[^3] í”„ë¡œê·¸ë¨ í—¤ë”ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§í¬ ì‘ì—…ì´ ì™„ë£Œëœ í›„ ì‹¤í–‰ ê°€ëŠ¥í•œ í˜•íƒœì˜ ì˜¤ë¸Œì íŠ¸ íŒŒì¼ì…ë‹ˆë‹¤.

## ELF íŒŒì¼ êµ¬ì¡° í™•ì¸í•˜ê¸°
### file
`file` ëª…ë ¹ì–´ëŠ” ELF íŒŒì¼ì˜ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ ì…‹ ì•„í‚¤í…ì²˜ë¥¼ í¬í•¨í•œ ê¸°ë³¸ ì •ë³´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```bash
root@docker-blog-ming:/blog/tools# file /usr/bin/ls
/usr/bin/ls: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=897f49cafa98c11d63e619e7e40352f855249c13, for GNU/Linux 3.2.0, stripped
```

### readelf
`readelf` ëª…ë ¹ì–´ëŠ” ELF íŒŒì¼ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```bash
root@docker-blog-ming:/blog/tools# readelf -a /usr/bin/ls
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              DYN (Position-Independent Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x6ab0
  Start of program headers:          64 (bytes into file)
  Start of section headers:          136224 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         13
  Size of section headers:           64 (bytes)
  Number of section headers:         31
  Section header string table index: 30
...
```

### objdump
`objdump`ëŠ” ì˜¤ë¸Œì íŠ¸ íŒŒì¼ì˜ ì •ë³´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```bash
root@docker-blog-ming:/blog/tools# objdump -f /usr/bin/ls

/usr/bin/ls:     file format elf64-x86-64
architecture: i386:x86-64, flags 0x00000150:
HAS_SYMS, DYNAMIC, D_PAGED
start address 0x0000000000006ab0
```

## ì •ë¦¬
[^1]: [Understanding the ELF File Format](https://linuxhint.com/understanding_elf_file_format/)ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
[^2]: [Executable and Linkable Format](https://stevens.netmeister.org/631/elf.html)ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
[^3]: [Fixing/Making Holes in Binaries](https://www.blackhat.com/presentations/bh-asia-02/Clowes/bh-asia-02-clowes.pdf)ë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
[^4]: [ELF format Object Fileì— ê´€í•œ ì§„ì‹¤](http://recipes.egloos.com/5010841)ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.